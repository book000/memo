# CLAUDE.md

## 目的

このファイルは Claude Code がこのプロジェクトで効果的に動作するための作業方針とプロジェクト固有のルールを定義します。

## 判断記録のルール

判断は必ずレビュー可能な形で記録すること。

1. 判断内容の要約を記載する
2. 検討した代替案を列挙する
3. 採用しなかった案とその理由を明記する
4. 前提条件・仮定・不確実性を明示する
5. 他エージェントによるレビュー可否を示す

前提・仮定・不確実性を明示し、仮定を事実のように扱わない。

## プロジェクト概要

- プロジェクト名: book000/memo
- 目的: Linux 系や各種プログラミング言語、フレームワークなどの技術メモ（備忘録）を管理し、Web サイトとして公開する
- サイト URL: https://memo.tomacheese.com
- 主な機能:
  - Markdown 形式での技術メモの記述
  - MkDocs による静的サイトの生成
  - textlint / markdownlint による文書品質の維持
  - GitHub Pages での自動デプロイ

## 重要ルール

### 会話言語

- すべての会話は**日本語**で行うこと

### コミット規約

- コミットメッセージは [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従うこと
- `<description>` は日本語で記載すること
- 形式: `<type>(<scope>): <description>`
- 例: `feat: ユーザー認証機能を追加`

### コメント言語

- コード内のコメントは日本語で記載すること（該当する場合）

### エラーメッセージ言語

- エラーメッセージは英語で記載すること（該当する場合）

### 日本語と英数字の間隔

- 日本語と英数字の間には半角スペースを挿入すること

## 環境のルール

### ブランチ命名

- [Conventional Branch](https://conventional-branch.github.io) に従うこと
- `<type>` は短縮形（feat, fix）を使用すること
- 形式: `<type>/<description>`
- 例: `feat/add-user-auth`

### GitHub リポジトリ調査

- GitHub リポジトリを調査のために参照する場合、テンポラリディレクトリに git clone して、そこでコード検索すること

### Renovate PR の扱い

- Renovate が作成した既存のプルリクエストに対して、追加コミットや更新を行わないこと

## コード改修時のルール

### エラーメッセージの絵文字統一

- 既存のエラーメッセージで先頭に絵文字がある場合は、全体でエラーメッセージに絵文字を設定すること
- 絵文字はエラーメッセージに即した一文字の絵文字であること

### TypeScript の skipLibCheck 禁止

- TypeScript プロジェクトにおいて、skipLibCheck を有効にして回避することは絶対にしないこと（該当する場合）

### docstring 記載

- 関数やインターフェースには、docstring (JSDoc など) を日本語で記載・更新すること（該当する場合）

## 相談ルール

Codex CLI や Gemini CLI の他エージェントに相談することができます。以下の観点で使い分けてください。

### Codex CLI (ask-codex)

- 実装コードに対するソースコードレビュー
- 関数設計、モジュール内部の実装方針などの局所的な技術判断
- アーキテクチャ、モジュール間契約、パフォーマンス／セキュリティといった全体影響の判断
- 実装の正当性確認、機械的ミスの検出、既存コードとの整合性確認

### Gemini CLI (ask-gemini)

- SaaS 仕様、言語・ランタイムのバージョン差、料金・制限・クォータといった、最新の適切な情報が必要な外部依存の判断
- 外部一次情報の確認、最新仕様の調査、外部前提条件の検証

### 指摘への対応ルール

他エージェントが指摘・異議を提示した場合、Claude Code は必ず以下のいずれかを行う。黙殺・無言での不採用は禁止する。

- 指摘を受け入れ、判断を修正する
- 指摘を退け、その理由を明示する

以下は必ず実施してください。

- 他エージェントの提案を鵜呑みにせず、その根拠や理由を理解する
- 自身の分析結果と他エージェントの意見が異なる場合は、双方の視点を比較検討する
- 最終的な判断は、両者の意見を総合的に評価した上で、自身で下す

## 開発コマンド

### 依存関係のインストール

```bash
# Node.js パッケージのインストール
pnpm install

# Python パッケージのインストール (MkDocs)
pip install -r requirements.txt
```

### 文書の品質チェックと修正

```bash
# textlint で文書をチェック
pnpm lint

# textlint で自動修正
pnpm fix

# textlint コマンドを直接実行
pnpm textlint
```

### ローカル開発

```bash
# MkDocs でローカルサーバーを起動
mkdocs serve
```

### ビルド

```bash
# MkDocs でサイトをビルド
mkdocs build
```

## アーキテクチャと主要ファイル

### ディレクトリ構造

```text
memo/
├── .github/           # GitHub 設定 (workflows, FUNDING.yml)
├── .vscode/           # VS Code 設定
├── docs/              # ドキュメントファイル (Markdown)
│   ├── assets/        # 画像などの静的ファイル
│   ├── css/           # カスタム CSS
│   ├── etc/           # その他のメモ
│   ├── game/          # ゲーム関連のメモ
│   ├── os/            # OS 関連のメモ
│   └── programming/   # プログラミング関連のメモ
├── scripts/           # ビルドスクリプト
├── mkdocs.yml         # MkDocs 設定
├── package.json       # Node.js 依存関係
├── requirements.txt   # Python 依存関係
├── .textlintrc        # textlint 設定
└── .markdownlint.jsonc # markdownlint 設定
```

### 主要ファイル

- `mkdocs.yml`: MkDocs の設定ファイル。サイト構造、テーマ、プラグイン、拡張機能を定義
- `.textlintrc`: textlint の設定ファイル。日本語文書の品質ルールを定義
- `.markdownlint.jsonc`: markdownlint の設定ファイル。Markdown 記法のルールを定義
- `docs/`: すべての Markdown ファイルを格納するディレクトリ
- `package.json`: textlint などの Node.js 依存関係を管理
- `requirements.txt`: MkDocs とプラグインの Python 依存関係を管理

## 実装パターン

### Markdown ファイル編集の推奨パターン

#### 文書作成の基本フロー

1. 適切なカテゴリ (`docs/programming/`, `docs/os/` など) にファイルを配置
2. ファイル名は小文字とハイフンを使用 (例: `nodejs-project.md`)
3. 前書きとして目的や概要を記述
4. 実際のコード例やスクリーンショットを含める
5. コミット後、`pnpm fix` → `pnpm lint` → 手動修正の順で品質を担保

#### 自動修正後の確認事項

`pnpm fix` によって自動修正されたことにより、文章として不成立な状態・意味不明な文章になっていないかはよく確認すること。

特に、"。" に置き換わるルールがあるが、これによって違和感のある文章となっていないかは確認する。
例えば「例」が「例。」になることがあるが、これは「以下は例。」と文章として成立させること。

### 日本語文書の品質ルール

1. 句読点は句点（。）と読点（、）を正しく使用する
2. 表記統一は同じ意味の言葉で統一した表記を使用する
3. 助詞の重複では同じ助詞の連続使用を避ける
4. 敬語では「ですます」調と「である」調の混在を避ける
5. 半角・全角では英数字は半角、日本語は全角を基本とする
6. スペースでは全角文字と半角文字の間に必要なスペースを入れる

### Markdown 記法の推奨パターン

- 見出しレベルは h1 から順序良く使用する（h1 は 1 つのファイルに 1 つ）
- コードブロックには言語を指定する
- リンクは明確でわかりやすい形式で記述する
- 画像には alt テキストをつける

### 非推奨パターン

- TODO コメントの残存（`.textlintrc` で禁止設定済み）
- 機密情報やパスワードなどの秘匿すべき情報の記載
- 著作権に触れる可能性のあるコードやコンテンツのコピー
- 不適切な言葉や差別的な内容の記載

## テスト

このプロジェクトでは、textlint と markdownlint による文書品質のチェックがテストに相当します。

### テスト方針

- すべての Markdown ファイルは textlint と markdownlint のチェックを通過すること
- コミット前に必ず `pnpm lint` を実行し、エラーがないことを確認すること
- 自動修正は `pnpm fix` を使用すること

### 追加テスト条件

- 文書編集後は、`pnpm fix` → `pnpm lint` → 手動修正の順で品質を担保すること
- 自動チェックは最後の砦とすること

## ドキュメント更新ルール

### 更新対象

このプロジェクト自体がドキュメントプロジェクトのため、すべての変更がドキュメント更新となります。

### 更新タイミング

- 新しい技術メモを追加した場合
- 既存の技術メモを更新した場合
- プロジェクト設定（MkDocs、textlint、markdownlint）を変更した場合

### 更新方法

1. Markdown ファイルを編集
2. `pnpm fix` で自動修正
3. `pnpm lint` でエラーチェック
4. 手動で残りのエラーや不自然な箇所を修正
5. ローカルで `mkdocs serve` を実行し、プレビューを確認
6. コミット・プッシュ

## 作業チェックリスト

### 新規改修時

1. プロジェクトを理解する
2. 作業ブランチが適切であることを確認する（すでに PR を提出しクローズされたブランチでないこと）
3. 最新のリモートブランチに基づいた新規ブランチであることを確認する
4. PR がクローズされた不要ブランチが削除済みであることを確認する
5. 指定されたパッケージマネージャー（pnpm）で依存関係をインストールする

### コミット・プッシュ前

1. コミットメッセージが Conventional Commits に従っていることを確認する（`<description>` は日本語）
2. コミット内容にセンシティブな情報が含まれていないことを確認する
3. Lint / Format エラーが発生しないことを確認する（`pnpm lint`）
4. 動作確認を行い、期待通り動作することを確認する（`mkdocs serve` でプレビュー）

### PR 作成前

1. PR 作成の依頼があることを確認する
2. コミット内容にセンシティブな情報が含まれていないことを確認する
3. コンフリクトの恐れがないことを確認する

### PR 作成後

1. コンフリクトがないことを確認する
2. PR 本文が最新状態のみを網羅していることを確認する（このブランチの現在の状態を、今までのこの PR での更新履歴を含むことなく、最新の状態のみ、漏れなく日本語で記載されていること）
3. `gh pr checks <PR ID> --watch` で GitHub Actions CI を待ち、その結果がエラーとなっていないことを確認する（成功している場合でも、ログを確認し、誤って成功扱いになっていないこと）
4. `request-review-copilot https://github.com/$OWNER/$REPO/pull/$PR_NUMBER` で GitHub Copilot へレビューを依頼する（コマンドが存在する場合）
5. 10 分以内に投稿される GitHub Copilot レビューへの対応を行うこと。対応したら、レビューコメントそれぞれに対して返信を行うこと（レビュアーに GitHub Copilot がアサインされていない場合はスキップして構わない）
6. `/code-review:code-review` によるコードレビューを実施したこと。コードレビュー内容に対しては、**スコアが 50 以上の指摘事項** に対して対応すること

## リポジトリ固有

### MkDocs について

- このプロジェクトは MkDocs with Material theme を使用して静的サイトを生成します
- `mkdocs.yml` でサイト構造、テーマ、プラグイン、拡張機能を設定しています
- GitHub Pages に自動デプロイされます

### textlint について

- textlint は日本語文書の品質を保つためのツールです
- `.textlintrc` でルールを設定しています
- 以下のルールが設定されています:
  - い抜き言葉の検出
  - フィラー（つなぎ表現）の禁止
  - サ抜き、サ入れ表現の誤用チェック
  - れ足す言葉のチェック
  - 同義語の表記ゆれチェック
  - TODO コメントの禁止
  - 日付と曜日の不一致の検出
  - ひらがな表記の推奨
  - 全角と半角アルファベットの混在チェック
  - スペース周りのスタイルチェック
  - 技術文書向けルール

### markdownlint について

- markdownlint は Markdown 記法の品質を保つためのツールです
- `.markdownlint.jsonc` でルールを設定しています
- 見出し、リスト、コードブロック、リンクなどの記法をチェックします

### Visual Studio Code 連携

- Visual Studio Code でこのプロジェクトを開くと、venv 環境下で mkdocs の serve が行われ、Chrome で `localhost:8080` が開きます

### ライセンス

- このリポジトリにあるすべてのコンテンツは当該ファイルに特記のない限り、CC BY-SA 4.0 の元で利用できます

### パッケージマネージャーの厳格なルール

- **pnpm のみを使用**すること。npm や npx は使用しないこと
- 誤って npm など別のパッケージマネージャーを使用したことにより、ロックファイルが生成された場合は削除すること
